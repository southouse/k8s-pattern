# 자기 인식
> 일부 애플리케이션은 자기 인식(self-awareness)을 해야하고 스스로에 대한 정보가 필요

## 문제
- 대부분 클라우드 네이티브 애플리케이션은 스테이트리스지만, 때로는 애플리케이션 자체에 대한 정보와 실행 중인 환경에 대한 정보가 필요할 수 있음
- 파드 이름, IP 주소 등 런타임 시에 파악 가능한 정보나 특정 자원 요청 및 제한처럼 정의된 정적 정보, 런타임 시에 사용자가 변경할 수 있는 애노테이션 및 레이블 같은 동적 정보가 필요
  - ex. 컨테이너의 사용 가능한 자원에 따라 애플리케이션 스레드 풀(thread-pool) 크기 조정 혹은 메모리 할당의 변경이나 중앙 서버로 메트릭을 보낼 때 파드 이름과 호스트 이름을 사용하는 등등의 여러 가지 예시가 있음

> 이와 같은 정보에 대해 쿠버네티스가 제공하는 것이 다운워드(Downward) API

## 해결책
- 다운워드 API를 사용하면 환경 변수 및 파일을 이용해 파드에 대한 메타데이터를 컨테이너 및 클러스터에 전달할 수 있음
- 다운워드 API를 사용하면 메타데이터가 파드에 삽입되어 로컬에서 사용 가능함
- `fieldRef.fieldPath`에서 사용 가능한 다운워드 API 정보
  |이름|설명|
  |---|---|
  |spec.nodeName|파드를 호스팅하는 노드 이름
  |status.hostIP|파드를 호스팅하는 노드 IP 주소
  |metadata.name|파드 이름
  |metadata.namespace|파드가 실행중인 네임스페이스
  |status.podIP|파드 IP 주소
  |spec.serviceAccountName|파드에서 사용하는 서비스 어카운트(ServiceAccount)
  |metadata.uid|파드의 고유 ID
  |metadata.labels['key']|파드의 레이블 키의 값
  |metadata.annotations['key']|파드의 애노테이션 키의 값
- `resourceFieldRef.resource`에서 사용 가능한 다운워드 API 정보
  |이름|설명|
  |---|---|
  |requests.cpu|컨테이너의 CPU 요청
  |limits.cpu|컨테이너의 CPU 제한
  |requests.memory|컨테이너의 메모리 요청
  |limits.memory|컨테이너의 메모리 제한
- 파드가 실행되는 동안 레이블과 애노테이션 같은 특정 메타데이터를 변경할 수 있지만, 파드를 다시 시작하지 않으면 환경 변수는 변경사항이 반영되지 않음
- 볼륨을 사용하여 변경되는 메타데이터를 반영할 수 있지만, 파일 변경을 감지하고 업데이트된 데이터를 읽는 것은 애플리케이션에서 처리해야 함

## 정리
- 다운워드 API의 단점 중 하나는 참조할 수 있는 고정된 수의 키를 제공한다는 것
- 애플리케이션에서 다른 자원이나 클러스터 관련 메타데이터 등의 추가 데이터를 필요로 하는 경우에는 API 서버에 쿼리해야 함

> 쿠버네티스 API 서버와 상호작용해서 다운워드 API가 제공하는 것 이상의 많은 자체 참조 정보를 얻을 수 있음