# 주기적 잡(Periodic Job)
> 작업단위 실행이 시간적 이벤트에 의해 트리거되도록 하여 배치 잡 패턴을 확장

## 문제
- 주기적 잡은 시스템 유지 보수나 관리 작업을 자동화하기 위해 사용
- 파일 전송을 통한 B2B 통합, DB 조회를 통한 애플리케이션 통합, 뉴스레터 이메일 전송, 오래된 파일 정리 및 보관 등으로 사용
- 단일 서버에서 실행되는 크론 잡은 관리하기가 어렵고 단일 장애 지점(single point of failure)이 될 수 있음
- 스케줄링의 회복성과 고가용성을 갖추도록 만드는 것에는 많은 리소스 사용이 필요
- 고가용성 스케줄러를 만들기 위해서는 전체 애플리케이션의 가용성이 높아야 함
- 스케줄러가 포함된 다중 인스턴스가 동시에 실행 중이면, 리더 선출 및 또 다른 분산 시스템 문제가 수반

> 쿠버네티스 크론잡 구현은 개발자들이 시간적 스케줄링 측면보다는 수행될 작업을 구현하는 데에 집중하게 함으로 써 문제를 해결

## 해결책
- 크론 잡(cron job)은 잡의 시간적 측면을 관리하여 지정된 시간에 주기적으로 잡을 수행하는 것이 가능
- 잡과는 다르게, 시간적 측면을 정의하기 위한 추가 필드가 있음
  - `spec.schedule`: 잡의 스케줄을 지정하기 위한 크론탭 항목
  - `spec.startingDeadlineSeconds`
    - 어떤 이유든 스케줄 시간을 놓친 잡에 대한 시작 시간을 지정
    - 특정 시간 내에 실행된 경우에만 유효한 잡은 설정을 안 하는 것이 좋음
  - `spec.concurrencyPolicy`
    - 동일한 크론잡에 의해 생성된 잡을 동시에 실행하는 방법을 정의
      - `Allow`: 이전 잡이 완료되지 않았어도 새로운 잡을 생성
      - `Forbid`: 현재 잡이 완료되지 않았다면 잡 생성을 건너 뜀
      - `Replace`: 현재 실행 중인 잡을 취소하고 새로운 잡을 생성
  - `spec.suspend`: 이미 시작된 잡은 영향을 주지 않고 모든 후속 잡의 실행을 일시 중단
  - `spec.successfulJobsHistoryLimit`과 `spec.failedJobsHistoryLimit`: 감사(audit) 목적으로 완료 및 실패한 잡을 설정된 값 개수만큼 유지

## 정리
- 크론잡이 파드나 컨테이너 자원 격리 같은 기본 요소 그리고 `자동 배치`나 `정상상태 점검`에서 다룬 여러 쿠버네티스 기능과 결합될 때, 매우 강력한 잡 스케줄링 시스템이 될 수 있음

> 크론잡을 구현할 때 애플리케이션은 중복 실행, 미실행, 병렬 실행, 취소 등의 실패 사례를 비롯한 예상치 못한 모든 오류 상황을 고려해야 함